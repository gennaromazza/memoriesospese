# Configurazione per SPA in sottocartella
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /wedgallery/
  
  # Non applicare regole di rewrite a file e cartelle reali
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  
  # Reindirizza tutte le richieste non trovate all'index.html, preservando anche i parametri di query
  RewriteRule ^(.*)$ index.html [L,QSA]
  
  # Regole esplicite per le rotte principali dell'applicazione
  # Questo garantisce che le navigazioni dirette funzionino correttamente
  RewriteRule ^gallery/(.*)$ index.html [L]
  RewriteRule ^view/(.*)$ index.html [L]
  RewriteRule ^admin(.*)$ index.html [L]
  RewriteRule ^request-password/(.*)$ index.html [L]
  RewriteRule ^password-result/(.*)$ index.html [L]
</IfModule>

# Configurazione CORS se necessario
<IfModule mod_headers.c>
  Header set Access-Control-Allow-Origin "*"
  Header set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
  Header set Access-Control-Allow-Headers "DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type"
</IfModule>

# Configurazione cache
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Immagini
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  
  # JavaScript e CSS
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  
  # Fonts
  ExpiresByType application/vnd.ms-fontobject "access plus 1 year"
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  
  # HTML (non mettere cache troppo lunga per l'HTML)
  ExpiresByType text/html "access plus 0 seconds"
  
  # Tutto il resto
  ExpiresDefault "access plus 1 week"
</IfModule>